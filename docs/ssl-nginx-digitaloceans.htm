<div class="section-content section-content-growable content Tutorial-content">
    

    <div class="container tutorial-header">
      <div class="featured-content-header">
        <span class="featured-items-right-bar-container">

    <div class="featured-items-right-bar-cta">
      <h3>Related</h3>
          <div class="featured-item-highlight" data-js="tutorial" data-analytics="">
            <span class="featured-item-title">Join the DigitalOcean Community</span>
            <span class="featured-item-highlight-image"><img width="45" height="45" alt="Community" src="https://digitalocean.cdn.prismic.io/digitalocean/8d8bc1f0-2a4b-473b-9793-2a240ea8ccb4_digitalocean-logo-mark-copy.svg"></span>
            <span class="featured-item-description">
              <p>Join 1M+ other developers and:</p>

<ul><li>Get help and share knowledge in Q&amp;A</li><li>Subscribe to topics of interest</li><li>Get courses &amp; tools that help you grow as a developer or small business owner</li></ul>
            </span>
            <a class="full-width-button small-button blue-button cta-button" href="https://www.digitalocean.com/community/auth/digitalocean?display=sessionless+register+button">Join Now</a>
          </div>
            <a href="/community/tutorials/how-to-configure-suricata-as-an-intrusion-prevention-system-ips-on-rocky-linux-8">
              <div class="featured-item-regular" data-js="tutorial">
                How To Configure Suricata as an Intrusion Prevention System (IPS) on Rocky Linux 8
                <span class="featured-item-category">
                  <img width="14" height="14" alt="Tutorial" src="/assets/community/tutorials/featured-item-tutorial-icon-bce4d5cc06536a907c48f6663a93392cdf6c5f30677b48439d1164c89fb71ad1.png">
                  Tutorial
                </span>
              </div>
</a>            <a href="/community/tutorials/how-to-configure-suricata-as-an-intrusion-prevention-system-ips-on-debian-11">
              <div class="featured-item-regular" data-js="tutorial">
                How To Configure Suricata as an Intrusion Prevention System (IPS) on Debian 11
                <span class="featured-item-category">
                  <img width="14" height="14" alt="Tutorial" src="/assets/community/tutorials/featured-item-tutorial-icon-bce4d5cc06536a907c48f6663a93392cdf6c5f30677b48439d1164c89fb71ad1.png">
                  Tutorial
                </span>
              </div>
</a>    </div>

    <script type="text/javascript">
      $(document).trigger('community:related_loaded');
    </script>
</span>

      </div>

      
      <h4 class="eyebrow">Tutorial</h4>
      <h1 class="content-title Tutorial-header">How To Create a Self-Signed SSL Certificate for Nginx on CentOS 7</h1>

      <span class="meta-section tags">
  <a class="tag" href="/community/tags/nginx">Nginx</a><a class="tag" href="/community/tags/centos">CentOS</a><a class="tag" href="/community/tags/security">Security</a>
</span>


      <div class="tutorial-authors-translations">
        <div class="tutorial-authors">
          <div class="component-collaborators-container">
  <ul class="component-collaborators-content">
        <li class="collaborator-byline-avatar">
          <a href="/community/users/jellingwood">
            <img alt="jellingwood" class="avatar avatar-large" src="https://secure.gravatar.com/avatar/60d901f61a6146e14a3e989bc1f4ef11?secure=true&amp;d=identicon" width="80" height="80">
</a>        </li>

    <li class="collaborators-byline-data">
        <p class="names">By <a href="/community/users/jellingwood">Justin Ellingwood</a></p>

      <span class="meta-section date-views">
  
  <span class="meta-section timestamp"><span class="tutorial-date-text">Published on</span><span class="tutorial-date">January  9, 2017</span></span>
<span class="meta-section pageviews"><span class="icon icon-eye v-mid"></span><span class="views-count v-mid">322.9k</span><span class="sr-only"> views</span></span></span>

    </li>
  </ul>
</div>

        </div>

      </div>
    </div>

    

  <div class="container versioned-tutorial-group-navigation">
    <h5 class="versioned-tutorial-group-navigation__heading">
        Not using CentOS 7?
        <br>
        <small>
          Choose a different version or distribution.
        </small>
    </h5>

    <select name="distribution_version" id="distribution_version" autocomplete="off" class="large-chosen-dropdown" style="display: none;"><option selected="selected" value="/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-on-centos-7">CentOS 7</option><option value="/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-on-debian-9">Debian 9</option><option value="/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-on-debian-8">Debian 8</option><option value="/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-on-debian-10">Debian 10</option><option value="/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-20-04-1">Ubuntu 20.04</option><option value="/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-18-04">Ubuntu 18.04</option><option value="/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-16-04">Ubuntu 16.04</option></select><div class="chosen-container chosen-container-single large-chosen-dropdown chosen-container-single-nosearch" title="" id="distribution_version_chosen" style="width: auto;"><a class="chosen-single">
  <span>CentOS 7</span>
  <div><b></b></div>
</a>
<div class="chosen-drop">
  <div class="chosen-search">
    <input class="chosen-search-input" type="text" autocomplete="off" readonly="">
  </div>
  <ul class="chosen-results"></ul>
<a class="versioned-tutorial-group-navigation__see-more" href="/community/tutorial_collections/how-to-create-a-self-signed-ssl-certificate-for-nginx">See More<span class="icon icon-website"></span></a></div></div>
  </div>


<div class="content-body tutorial-content" data-growable-markdown="">
  
  <h3 id="introduction">Introduction</h3>

<p><strong>TLS</strong>, or transport layer security, and its predecessor <strong>SSL</strong>, which stands for secure sockets layer, are web protocols used to wrap normal traffic in a protected, encrypted wrapper.</p>

<p>Using this technology, servers can send traffic safely between the server and clients without the possibility of the messages being  intercepted by outside parties.  The certificate system also assists users in verifying the identity of the sites that they are connecting with.</p>

<p>In this guide, we will show you how to set up a self-signed SSL certificate for use with an Nginx web server on a CentOS 7 server.</p>

<span class="note"><p>
<strong>Note:</strong> A self-signed certificate will encrypt communication between your server and any clients.  However, because it is not signed by any of the trusted certificate authorities included with web browsers, users cannot use the certificate to validate the identity of your server automatically.</p>

<p>A self-signed certificate may be appropriate if you do not have a domain name associated with your server and for instances where the encrypted web interface is not user-facing.  If you <em>do</em> have a domain name, in many cases it is better to use a CA-signed certificate.  To learn how to set up a free trusted certificate, follow our guide on <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-centos-7">setting up Nginx with a Let’s Encrypt certificate on CentOS 7</a>.<br></p></span>

<h2 id="prerequisites">Prerequisites</h2>

<p>First, you should have a non-root user configured with <code>sudo</code> privileges.  You can learn how to set up such a user account by following our <a href="https://www.digitalocean.com/community/articles/initial-server-setup-with-centos-7">initial server setup for CentOS 7</a>.</p>

<p>When you are ready to get started, log into your server as your <code>sudo</code> user.</p>

<h2 id="step-1-install-nginx-and-adjust-the-firewall">Step 1: Install Nginx and Adjust the Firewall</h2>

<p>Before we begin, we should make sure that the Nginx web server is installed on our machine.</p>

<p>While Nginx is not available in CentOS’s default repositories, it <em>is</em> present in the EPEL (extra packages for Enterprise Linux) repository.  We can enable the EPEL repository to give our server access to the Nginx package by typing:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> yum <span class="token function">install</span> epel-release
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Next, we can install Nginx by typing:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> yum <span class="token function">install</span> nginx
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Start the Nginx service by typing:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> systemctl start nginx
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Check that the service is up and running by typing:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><ul class="prefixed"><li class="line" data-prefix="$">systemctl status nginx
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div><pre class="code-pre "><code><div class="secondary-code-label " title="Output">Output</div>● nginx.service - The nginx HTTP and reverse proxy server
   Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; vendor preset: disabled)
   Active: <span class="highlight">active (running)</span> since Fri 2017-01-06 17:27:50 UTC; 28s ago

. . .

Jan 06 17:27:50 centos-512mb-nyc3-01 systemd[1]: <span class="highlight">Started The nginx HTTP and reverse proxy server.</span>
</code></pre>
<p>You will also want to enable Nginx, so it starts when your server boots:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> nginx
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div><pre class="code-pre "><code><div class="secondary-code-label " title="Output">Output</div>Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.
</code></pre>
<p>Next, we need to make sure that we are not blocking access to port 80 and 443 with a firewall.  If you are not using a firewall, you can skip ahead to the next section.</p>

<p>If you have a <strong>firewalld</strong> firewall running, you can open these ports by typing:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> firewall-cmd --add-service<span class="token operator">=</span>http
</li><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> firewall-cmd --add-service<span class="token operator">=</span>https
</li><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> firewall-cmd --runtime-to-permanent
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>If have an <strong>iptables</strong> firewall running, the commands you need to run are highly dependent on your current rule set.  For a basic rule set, you can add HTTP and HTTPS access by typing:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> iptables -I INPUT -p tcp -m tcp --dport <span class="token number">80</span> -j ACCEPT
</li><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> iptables -I INPUT -p tcp -m tcp --dport <span class="token number">443</span> -j ACCEPT
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>You should now be able to access the default Nginx page through a web browser.</p>

<h2 id="step-2-create-the-ssl-certificate">Step 2: Create the SSL Certificate</h2>

<p>TLS/SSL works by using a combination of a public certificate and a private key.  The SSL key is kept secret on the server.  It is used to encrypt content sent to clients.  The SSL certificate is publicly shared with anyone requesting the content.  It can be used to decrypt the content signed by the associated SSL key.</p>

<p>The <code>/etc/ssl/certs</code> directory, which can be used to hold the public certificate, should already exist on the server.  Let’s create an <code>/etc/ssl/private</code> directory as well, to hold the private key file.  Since the secrecy of this key is essential for security, we will lock down the permissions to prevent unauthorized access:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> <span class="token function">mkdir</span> /etc/ssl/private
</li><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">700</span> /etc/ssl/private
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Now, we can create a self-signed key and certificate pair with OpenSSL in a single command by typing:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> openssl req -x509 -nodes -days <span class="token number">365</span> -newkey rsa:2048 -keyout /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/certs/nginx-selfsigned.crt
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>You will be asked a series of questions.  Before we go over that, let’s take a look at what is happening in the command we are issuing:</p>

<ul>
<li><strong>openssl</strong>: This is the basic command line tool for creating and managing OpenSSL certificates, keys, and other files.</li>
<li><strong>req</strong>: This subcommand specifies that we want to use X.509 certificate signing request (CSR) management.  The “X.509” is a public key infrastructure standard that SSL and TLS adheres to for its key and certificate management.  We want to create a new X.509 cert, so we are using this subcommand.</li>
<li><strong>-x509</strong>: This further modifies the previous subcommand by telling the utility that we want to make a self-signed certificate instead of generating a certificate signing request, as would normally happen.</li>
<li><strong>-nodes</strong>: This tells OpenSSL to skip the option to secure our certificate with a passphrase.  We need Nginx to be able to read the file, without user intervention, when the server starts up.  A passphrase would prevent this from happening because we would have to enter it after every restart.</li>
<li><strong>-days 365</strong>: This option sets the length of time that the certificate will be considered valid.  We set it for one year here.</li>
<li><strong>-newkey rsa:2048</strong>: This specifies that we want to generate a new certificate and a new key at the same time.  We did not create the key that is required to sign the certificate in a previous step, so we need to create it along with the certificate.  The <code>rsa:2048</code> portion tells it to make an RSA key that is 2048 bits long.</li>
<li><strong>-keyout</strong>: This line tells OpenSSL where to place the generated private key file that we are creating.</li>
<li><strong>-out</strong>: This tells OpenSSL where to place the certificate that we are creating.</li>
</ul>

<p>As we stated above, these options will create both a key file and a certificate.  We will be asked a few questions about our server in order to embed the information correctly in the certificate.</p>

<p>Fill out the prompts appropriately.  <strong>The most important line is the one that requests the <code>Common Name (e.g. server FQDN or YOUR name)</code>.  You need to enter the domain name associated with your server or your server’s public IP address.</strong></p>

<p>The entirety of the prompts will look something like this:</p>
<pre class="code-pre "><code><div class="secondary-code-label " title="Output">Output</div>Country Name (2 letter code) [AU]:<span class="highlight">US</span>
State or Province Name (full name) [Some-State]:<span class="highlight">New York</span>
Locality Name (eg, city) []:<span class="highlight">New York City</span>
Organization Name (eg, company) [Internet Widgits Pty Ltd]:<span class="highlight">Bouncy Castles, Inc.</span>
Organizational Unit Name (eg, section) []:<span class="highlight">Ministry of Water Slides</span>
Common Name (e.g. server FQDN or YOUR name) []:<span class="highlight">server_IP_address</span>
Email Address []:<span class="highlight">admin@your_domain.com</span>
</code></pre>
<p>Both of the files you created will be placed in the appropriate subdirectories of the <code>/etc/ssl</code> directory.</p>

<p>While we are using OpenSSL, we should also create a strong Diffie-Hellman group, which is used in negotiating <a href="https://en.wikipedia.org/wiki/Forward_secrecy">Perfect Forward Secrecy</a> with clients.</p>

<p>We can do this by typing:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> openssl dhparam -out /etc/ssl/certs/dhparam.pem <span class="token number">2048</span>
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>This may take a few minutes, but when it’s done you will have a strong DH group at <code>/etc/ssl/certs/dhparam.pem</code> that we can use in our configuration.</p>

<h2 id="step-3-configure-nginx-to-use-ssl">Step 3: Configure Nginx to Use SSL</h2>

<p>The default Nginx configuration in CentOS is fairly unstructured, with the default HTTP server block living within the main configuration file.  Nginx will check for files ending in <code>.conf</code> in the <code>/etc/nginx/conf.d</code> directory for additional configuration.</p>

<p>We will create a new file in this directory to configure a server block that serves content using the certificate files we generated.  We can then optionally configure the default server block to redirect HTTP requests to HTTPS.</p>

<h3 id="create-the-tls-ssl-server-block">Create the TLS/SSL Server Block</h3>

<p>Create and open a file called <code>ssl.conf</code> in the <code>/etc/nginx/conf.d</code> directory:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> <span class="token function">vi</span> /etc/nginx/conf.d/ssl.conf
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Inside, begin by opening a <code>server</code> block.  By default, TLS/SSL connections use port 443, so that should be our <code>listen</code> port.  The <code>server_name</code> should be set to the server’s domain name or IP address that you used as the Common Name when generating your certificate.  Next, use the <code>ssl_certificate</code>, <code>ssl_certificate_key</code>, and <code>ssl_dhparam</code> directives to set the location of the SSL files we generated:</p>
<div class="code-label " title="/etc/nginx/conf.d/ssl.conf">/etc/nginx/conf.d/ssl.conf</div><div class="code-toolbar"><div class="context"><pre class="code-pre  language-bash"><code class="code-highlight  language-bash">server <span class="token punctuation">{</span>
    listen <span class="token number">443</span> http2 ssl<span class="token punctuation">;</span>
    listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:443 http2 ssl<span class="token punctuation">;</span>

    server_name <span class="highlight">server_IP_address</span><span class="token punctuation">;</span>

    ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt<span class="token punctuation">;</span>
    ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key<span class="token punctuation">;</span>
    ssl_dhparam /etc/ssl/certs/dhparam.pem<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Next, we will add some additional SSL options that will increase our site’s security.  The options we will use are recommendations from <a href="https://raymii.org/s/static/About.html">Remy van Elst</a> on the <a href="https://cipherli.st">Cipherli.st</a> site.  This site is designed to provide easy-to-consume encryption settings for popular software.  You can learn more about his decisions regarding the Nginx choices by reading <a href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html">Strong SSL Security on nginx</a>.</p>

<span class="note"><p>
<strong>Note:</strong> The default suggested settings on <a href="https://cipherli.st">Cipherli.st</a> offer strong security.  Sometimes, this comes at the cost of greater client compatibility.  If you need to support older clients, there is an alternative list that can be accessed by clicking on the link labeled “Yes, give me a ciphersuite that works with legacy / old software.”</p>

<p>The compatibility list can be used instead of the default suggestions in the configuration above between the two comment blocks.  The choice of which config you use will depend largely on what you need to support.<br></p></span>

<p>There are a few pieces of the configuration that you may wish to modify.  First, you can add your preferred DNS resolver for upstream requests to the <code>resolver</code> directive.  We used Google’s for this guide, but you can change this if you have other preferences.</p>

<p>Finally, you should take a moment to read up on <a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HTTP Strict Transport Security, or HSTS</a>, and specifically about the <a href="https://hstspreload.appspot.com/">“preload” functionality</a>.  Preloading HSTS provides increased security, but can have far reaching consequences if accidentally enabled or enabled incorrectly.  In this guide, we will not preload the settings, but you can modify that if you are sure you understand the implications.</p>
<div class="code-label " title="/etc/nginx/conf.d/ssl.conf">/etc/nginx/conf.d/ssl.conf</div><div class="code-toolbar"><div class="context"><pre class="code-pre  language-bash"><code class="code-highlight  language-bash">server <span class="token punctuation">{</span>
    listen <span class="token number">443</span> http2 ssl<span class="token punctuation">;</span>
    listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:443 http2 ssl<span class="token punctuation">;</span>

    server_name <span class="highlight">server_IP_address</span><span class="token punctuation">;</span>

    ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt<span class="token punctuation">;</span>
    ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key<span class="token punctuation">;</span>
    ssl_dhparam /etc/ssl/certs/dhparam.pem<span class="token punctuation">;</span>

    <span class="token comment">########################################################################</span>
    <span class="token comment"># from https://cipherli.st/                                            #</span>
    <span class="token comment"># and https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html #</span>
    <span class="token comment">########################################################################</span>

    ssl_protocols TLSv1 TLSv1.1 TLSv1.2<span class="token punctuation">;</span>
    ssl_prefer_server_ciphers on<span class="token punctuation">;</span>
    ssl_ciphers <span class="token string">"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH"</span><span class="token punctuation">;</span>
    ssl_ecdh_curve secp384r1<span class="token punctuation">;</span>
    ssl_session_cache shared:SSL:10m<span class="token punctuation">;</span>
    ssl_session_tickets off<span class="token punctuation">;</span>
    ssl_stapling on<span class="token punctuation">;</span>
    ssl_stapling_verify on<span class="token punctuation">;</span>
    resolver <span class="token number"></span><span class="highlight"><span class="token number">8.8</span>.8.8 <span class="token number">8.8</span>.4.4</span> <span class="token assign-left variable">valid</span><span class="token operator">=</span>300s<span class="token punctuation">;</span>
    resolver_timeout 5s<span class="token punctuation">;</span>
    <span class="token comment"><span class="highlight"># Disable preloading HSTS for now.  You can use the commented out header line that includes</span></span>
    <span class="token comment"><span class="highlight"># the "preload" directive if you understand the implications.</span></span>
    <span class="token comment"><span class="highlight">#</span>add_header Strict-Transport-Security "max-age=63072000; includeSubdomains; preload";</span>
    <span class="highlight">add_header Strict-Transport-Security <span class="token string">"max-age=63072000; includeSubdomains"</span><span class="token punctuation">;</span></span><span class="token punctuation"></span>
    add_header X-Frame-Options DENY<span class="token punctuation">;</span>
    add_header X-Content-Type-Options nosniff<span class="token punctuation">;</span>

    <span class="token comment">##################################</span>
    <span class="token comment"># END https://cipherli.st/ BLOCK #</span>
    <span class="token comment">##################################</span>
<span class="token punctuation">}</span></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Because we are using a self-signed certificate, the SSL stapling will not be used.  Nginx will simply output a warning, disable stapling for our self-signed cert, and continue to operate correctly.</p>

<p>Finally, add the rest of the Nginx configuration for your site.  This will differ depending on your needs.  We will just copy some of the directives used in the default location block for our example, which will set the document root and some error pages:</p>
<div class="code-label " title="/etc/nginx/conf.d/ssl.conf">/etc/nginx/conf.d/ssl.conf</div><div class="code-toolbar"><div class="context"><pre class="code-pre  language-bash"><code class="code-highlight  language-bash">server <span class="token punctuation">{</span>
    listen <span class="token number">443</span> http2 ssl<span class="token punctuation">;</span>
    listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:443 http2 ssl<span class="token punctuation">;</span>

    server_name <span class="highlight">server_IP_address</span><span class="token punctuation">;</span>

    ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt<span class="token punctuation">;</span>
    ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key<span class="token punctuation">;</span>
    ssl_dhparam /etc/ssl/certs/dhparam.pem<span class="token punctuation">;</span>

    <span class="token comment">########################################################################</span>
    <span class="token comment"># from https://cipherli.st/                                            #</span>
    <span class="token comment"># and https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html #</span>
    <span class="token comment">########################################################################</span>

    <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>

    <span class="token comment">##################################</span>
    <span class="token comment"># END https://cipherli.st/ BLOCK #</span>
    <span class="token comment">##################################</span>

    <span class="highlight">root /usr/share/nginx/html<span class="token punctuation">;</span></span><span class="token punctuation"></span>

    <span class="highlight">location / <span class="token punctuation">{</span></span><span class="token punctuation"></span>
    <span class="token punctuation"><span class="highlight">}</span></span>

    <span class="highlight">error_page <span class="token number">404</span> /404.html<span class="token punctuation">;</span></span><span class="token punctuation"></span>
    <span class="highlight">location <span class="token operator">=</span> /404.html <span class="token punctuation">{</span></span><span class="token punctuation"></span>
    <span class="token punctuation"><span class="highlight">}</span></span>

    <span class="highlight">error_page <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html<span class="token punctuation">;</span></span><span class="token punctuation"></span>
    <span class="highlight">location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span></span><span class="token punctuation"></span>
    <span class="token punctuation"><span class="highlight">}</span></span>
<span class="token punctuation">}</span></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>When you are finished, save and exit. This configures Nginx to use our generated SSL certificate to encrypt traffic.  The SSL options specified ensure that only the most secure protocols and ciphers will be used.  Note that this example configuration simply serves the default Nginx page, so you may want to modify it to meet your needs.</p>

<h3 id="optional-create-a-redirect-from-http-to-https">(Optional) Create a Redirect from HTTP to HTTPS</h3>

<p>With our current configuration, Nginx responds with encrypted content for requests on port 443, but responds with unencrypted content for requests on port 80.  This means that our site offers encryption, but does not enforce its usage.  This may be fine for some use cases, but it is usually better to require encryption.  This is especially important when confidential data like passwords may be transferred between the browser and the server.</p>

<p>Thankfully, the default Nginx configuration file allows us to easily add directives to the default port 80 server block by adding files in the <code>/etc/nginx/default.d</code> directory. Create a new file called <code>ssl-redirect.conf</code> and open it for editing with this command:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> <span class="token function">vi</span> /etc/nginx/default.d/ssl-redirect.conf
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Then paste in this line:</p>
<div class="code-label " title="/etc/nginx/default.d/ssl-redirect.conf">/etc/nginx/default.d/ssl-redirect.conf</div><div class="code-toolbar"><div class="context"><pre class="code-pre  language-bash"><code class="code-highlight  language-bash"><span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span>/<span class="token punctuation">;</span></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Save and close the file when you are finished. This configures the HTTP on port 80 (default) server block to redirect incoming requests to the HTTPS server block we configured.</p>

<h2 id="step-4-enable-the-changes-in-nginx">Step 4: Enable the Changes in Nginx</h2>

<p>Now that we’ve made our changes, we can restart Nginx to implement our new configuration.</p>

<p>First, we should check to make sure that there are no syntax errors in our files.  We can do this by typing:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> nginx -t
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>If everything is successful, you will get a result that looks like this:</p>
<pre class="code-pre "><code><div class="secondary-code-label " title="Output">Output</div>nginx: [warn] "ssl_stapling" ignored, issuer certificate not found
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
</code></pre>
<p>Notice the warning in the beginning.  As noted earlier, this particular setting throws a warning since our self-signed certificate can’t use SSL stapling.  This is expected and our server can still encrypt connections correctly.</p>

<p>If your output matches the above, your configuration file has no syntax errors.  We can safely restart Nginx to implement our changes:</p>
<div class="code-toolbar"><div class="context"><pre class="code-pre command prefixed language-bash"><code class="code-highlight  language-bash"><span class="token function"></span><ul class="prefixed"><span class="token function"></span><li class="line" data-prefix="$"><span class="token function">sudo</span> systemctl restart nginx
</li></ul></code></pre><span style="font-size: 0px; line-height: 0; opacity: 0; pointer-events: none; position: absolute;">&nbsp;</span></div><div class="toolbar"><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>The Nginx process will be restarted, implementing the SSL settings we configured.</p>

<h2 id="step-5-test-encryption">Step 5: Test Encryption</h2>

<p>Now, we’re ready to test our SSL server.</p>

<p>Open your web browser and type <code>https://</code> followed by your server’s domain name or IP into the address bar:</p>
<pre class="code-pre "><code>https://<span class="highlight">server_domain_or_IP</span>
</code></pre>
<p>Because the certificate we created isn’t signed by one of your browser’s trusted certificate authorities, you will likely see a scary looking warning like the one below:</p>

<p><img src="https://assets.digitalocean.com/articles/nginx_ssl_1604/self_signed_warning.png" alt="Nginx self-signed cert warning"></p>

<p>This is expected and normal.  We are only interested in the encryption aspect of our certificate, not the third party validation of our host’s authenticity.  Click “ADVANCED” and then the link provided to proceed to your host anyway:</p>

<p><img src="https://assets.digitalocean.com/articles/nginx_ssl_1604/warning_override.png" alt="Nginx self-signed override"></p>

<p>You should be taken to your site.  If you look in the browser address bar, you will see some indication of partial security.  This might be a lock with an “x” over it or a triangle with an exclamation point.  In this case, this just means that the certificate cannot be validated. It is still encrypting your connection.</p>

<p>If you configured Nginx to redirect HTTP requests to HTTPS, you can also check whether the redirect functions correctly:</p>
<pre class="code-pre "><code>http://<span class="highlight">server_domain_or_IP</span>
</code></pre>
<p>If this results in the same icon, this means that your redirect worked correctly.</p>

<h2 id="conclusion">Conclusion</h2>

<p>You have configured your Nginx server to use strong encryption for client connections.  This will allow you serve requests securely, and will prevent outside parties from reading your traffic.</p>

</div>

</div>